<thead class="table-light">
<!-- TODO: Доделать фильтры -->
<tr>
  <th>
    <%= f.search_field :username_cont,
                       placeholder: "Логин",
                       class: "form-control form-control-sm auto-search",
                       value: params.dig(:q, :username_cont) %>
  </th>
  <th>
    <%= f.search_field :email_cont,
                       placeholder: "Email",
                       class: "form-control form-control-sm auto-search",
                       value: params.dig(:q, :email_cont) %>
  </th>
  <th>
    <%= select_tag 'q[role_id_eq]',
                   options_for_select([['Все роли', '']] + Role.pluck(:name, :id), selected: params.dig(:q, :role_id_eq)),
                   class: 'form-select form-select-sm auto-submit' %>
  </th>

  <th>
    <div class="dropdown w-100">
      <button class="form-control form-control-sm dropdown-toggle text-start"
              type="button"
              data-bs-toggle="dropdown"
              aria-expanded="false">
        <%= (params.dig(:q, :sign_in_count_gteq).presence || params.dig(:q, :sign_in_count_lteq).presence) ? "Фильтр" : "Фильтр" %>
      </button>

      <div class="dropdown-menu p-3 shadow w-100" style="min-width: 220px;">
        <label class="form-label small mb-1">Диапазон входов</label>
        <div class="input-group input-group-sm">
          <span class="input-group-text">от</span>
          <%= f.number_field :sign_in_count_gteq, class: "form-control form-control-sm auto-search", value: params.dig(:q, :sign_in_count_gteq) %>
          <span class="input-group-text">до</span>
          <%= f.number_field :sign_in_count_lteq, class: "form-control form-control-sm auto-search", value: params.dig(:q, :sign_in_count_lteq) %>
        </div>
      </div>
    </div>
  </th>

 <th></th>



  <th></th>
<!--  <th></th>-->
<!--  <th></th>-->

  <th>
    <%= date_field_tag 'q[created_at_eq]',
                       params.dig(:q, :created_at_eq),
                       class: "form-control form-control-sm auto-submit",
                       placeholder: "Дата регистрации" %>
  </th>





  <th class="text-end">
    <div class="d-flex gap-2 justify-content-end">
      <%= button_tag 'Очистить', type: 'button', class: 'btn btn-secondary btn-sm', id: 'reset-filters' %>
    </div>
  </th>
</tr>
</thead>

<script>
    document.addEventListener("DOMContentLoaded", function () {

        document.getElementById("reset-filters")?.addEventListener("click", function () {
            const form = document.getElementById("search-form");
            if (!form) return;

            form.querySelectorAll("input[type='text'], input[type='number'], input[type='date'], input[type='search']").forEach(input => {
                input.value = "";
            });

            form.querySelectorAll("input[type='checkbox'], input[type='radio']").forEach(input => {
                input.checked = false;
            });

            form.querySelectorAll("select").forEach(select => {
                select.selectedIndex = 0;
            });

            const sortInput = form.querySelector("input[name='q[s]']");
            if (sortInput) sortInput.value = "";

            Rails.fire(form, 'submit');
        });

// Авто-поиск при вводе текста
        document.querySelectorAll(".auto-search").forEach(input => {
            input.addEventListener("input", function() {
                clearTimeout(this.dataset.timer);
                this.dataset.timer = setTimeout(() => {
                    document.getElementById("search-form").requestSubmit();
                }, 300);
            });
        });

        document.querySelectorAll('.auto-submit').forEach(el => {
            el.addEventListener('change', () => {
                const form = document.getElementById('search-form');
                if (form) Rails.fire(form, 'submit');
            });
        });
    });
</script>